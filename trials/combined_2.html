<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags and Title -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Data Sharing Consent</title>
    <!-- Unified CSS -->
    <style>
        /* General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #e6f0ec;
            color: #333;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        /* Container */
        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #fff;
            overflow-y: auto;
        }

        /* Hidden class for hiding pages */
        .hidden {
            display: none;
        }

        /* Header */
        header {
            background-color: #e6f0ec;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        header h1 {
            font-size: 20px;
            font-weight: bold;
            flex: 1;
            text-align: center;
        }

        .back-button {
            font-size: 24px;
            cursor: pointer;
        }

        /* Buttons */
        button {
            width: 90%;
            max-width: 400px;
            padding: 15px;
            margin: 20px auto;
            background: #0056b3;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            cursor: pointer;
            display: block;
        }

        button:hover {
            background: #003580;
        }

        /* Forms */
        form {
            padding: 20px;
        }

        label {
            display: block;
            margin: 15px 0 5px;
        }

        input[type="text"],
        input[type="password"],
        input[type="date"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 12px;
            font-size: 16px;
        }

        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background-color: #f0f0f0;
            position: relative;
            margin: 10px 0;
        }

        .progress {
            background-color: #ffd700;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Content Sections */
        .content-section {
            padding: 20px;
        }

        .content-section h2 {
            font-size: 22px;
            margin-bottom: 20px;
            text-align: center;
        }

        .content-section p {
            color: #666;
            margin-bottom: 15px;
            text-align: center;
        }

        /* Account Options */
        .account-options {
            margin-top: 20px;
        }

        .account-option {
            background-color: #f9f9f9;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .account-option.active {
            border-color: #0056b3;
        }

        .account-option img {
            width: 40px;
            margin-right: 15px;
        }

        .account-option h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        /* Checkbox List */
        .checkbox-list {
            list-style: none;
            padding: 0;
        }

        .checkbox-list li {
            background-color: #f9f9f9;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .checkbox-list li.active {
            border-color: #0056b3;
        }

        .checkbox-list li img {
            width: 30px;
            margin-right: 15px;
        }

        .checkbox-list li label {
            flex: 1;
            font-size: 16px;
        }

        .checkbox-list li input[type="checkbox"] {
            display: none;
        }

        /* Footer Info */
        .footer-info {
            background-color: #d1e7dd;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        /* Extra Info */
        #extra-info {
            background-color: #f0f4f3;
            margin-top: 20px;
            border-radius: 12px;
            padding: 15px;
            display: none;
        }

        /* Steps Info */
        #steps-info {
            background-color: #f0f4f3;
            margin-top: 10px;
            border-radius: 12px;
            padding: 15px;
            display: none;
        }

        /* Success Message */
        .success-message {
            text-align: center;
            padding: 40px;
        }

        .success-message .success-icon {
            font-size: 48px;
            color: #32a852;
            margin-bottom: 20px;
        }

        /* Date Range */
        .date-range input {
            width: 45%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 12px;
            font-size: 16px;
        }

        /* Transitions */
        .fade-enter {
            opacity: 0;
            transition: opacity 0.5s;
        }

        .fade-enter-active {
            opacity: 1;
        }

        /* Media Queries for Mobile */
        @media (max-width: 768px) {
            header h1 {
                font-size: 18px;
            }

            .content-section h2 {
                font-size: 20px;
            }

            .account-option h3 {
                font-size: 16px;
            }

            .account-option p {
                font-size: 14px;
            }

            button {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Container -->
    <div class="container">

        <!-- Page 1: Login Form -->
        <div id="page1" class="content-section">
            <header>
                <div></div>
                <h1>Login to Your Account</h1>
            </header>
            <form id="loginForm">
                <label for="username">Username:</label>
                <input type="text" id="username">
                <label for="password">Password:</label>
                <input type="password" id="password">
                <button type="button" onclick="showPage('page2')">Login</button>
            </form>
        </div>

        <!-- Page 2: Activate Personal Wealth Advisor -->
        <div id="page2" class="content-section hidden">
            <header>
                <div class="back-button" onclick="showPage('page1')">&#8592;</div>
                <h1>Share Accounts</h1>
            </header>
            <main>
                <div class="illustration">
                    <img src="https://via.placeholder.com/250" alt="Wealth Advisor Illustration" style="display: block; margin: 0 auto;">
                </div>
                <h2>Activate your personal wealth advisor</h2>
                <p>Accounts we need to give you a robust summary</p>
                <div class="account-options">
                    <div class="account-option" onclick="toggleAccountOption(this, 'Bank Accounts')">
                        <img src="https://img.icons8.com/ios-filled/50/0056b3/bank.png" alt="Bank Accounts">
                        <div>
                            <h3>Bank Accounts</h3>
                            <p>Savings Account, Fixed Deposits</p>
                        </div>
                    </div>
                    <div class="account-option" onclick="toggleAccountOption(this, 'Mutual Funds')">
                        <img src="https://img.icons8.com/ios-filled/50/0056b3/investment-portfolio.png" alt="Mutual Funds">
                        <div>
                            <h3>Mutual Funds</h3>
                            <p>Investments and Portfolios</p>
                        </div>
                    </div>
                </div>
                <div class="footer-info">
                    <p>We can only analyse account information</p>
                    <p>We cannot charge or make payments from your account</p>
                </div>
                <footer>
                    <button onclick="toggleInfo()">Read more about Sharing Accounts</button>
                    <div id="extra-info">
                        <h3>What does Share Accounts mean in detail?</h3>
                        <p>Sharing your accounts allows the wealth advisor to provide a robust analysis of your financial situation. Your account information will be securely shared through a central bank-authorized aggregator service. This service ensures your data is encrypted and protected at all times.</p>
                        <h3>What is an Account Aggregator?</h3>
                        <p>An account aggregator is a service that collects and organizes financial data from different accounts. This data is shared only with your consent, ensuring a holistic view of your financial assets without risking your privacy or control over your accounts.</p>
                    </div>
                    <button onclick="proceedFromPage2()">Share Accounts</button>
                    <p>Secure & Quick Sharing via CENTRAL BANK-authorized Account Aggregator Services</p>
                </footer>
            </main>
        </div>

        <!-- Page 3: Bank Selection -->
        <div id="page3" class="content-section hidden">
            <header>
                <div class="back-button" onclick="showPage('page2')">&#8592;</div>
                <h1>Share Accounts</h1>
            </header>
            <div class="info">
                <p style="text-align: center;">Unable to support joint account holders</p>
            </div>
            <div class="search-container" style="margin-top: 20px; text-align: center;">
                <input type="text" placeholder="Search Here" id="search-input" style="width: 90%; padding: 10px; border-radius: 12px; border: 1px solid #ccc;">
            </div>
            <ul class="checkbox-list" id="bankList">
                <li onclick="toggleCheckbox(this)">
                    <img src="https://via.placeholder.com/30" alt="Bank 1">
                    <label>Bank 1</label>
                    <input type="checkbox" value="Bank 1" class="bank">
                </li>
                <li onclick="toggleCheckbox(this)">
                    <img src="https://via.placeholder.com/30" alt="Bank 2">
                    <label>Bank 2</label>
                    <input type="checkbox" value="Bank 2" class="bank">
                </li>
                <li onclick="toggleCheckbox(this)">
                    <img src="https://via.placeholder.com/30" alt="Bank 3">
                    <label>Bank 3</label>
                    <input type="checkbox" value="Bank 3" class="bank">
                </li>
                <li onclick="toggleCheckbox(this)">
                    <img src="https://via.placeholder.com/30" alt="Bank 4">
                    <label>Bank 4</label>
                    <input type="checkbox" value="Bank 4" class="bank">
                </li>
                <li onclick="toggleCheckbox(this)">
                    <img src="https://via.placeholder.com/30" alt="Bank 5">
                    <label>Bank 5</label>
                    <input type="checkbox" value="Bank 5" class="bank">
                </li>
            </ul>
            <button onclick="proceedFromPage3()">Next</button>
        </div>

        <!-- Page 4: Share Accounts Partner Info -->
        <div id="page4" class="content-section hidden">
            <header>
                <div class="back-button" onclick="showPage('page3')">&#8592;</div>
                <h1>Share Accounts</h1>
            </header>
            <div class="partner-section" style="text-align: center; margin-top: 20px;">
                <div class="partner-text" style="font-size: 18px; font-weight: bold; margin-bottom: 20px;">
                    We have partnered with DATAUSER to securely share your accounts
                </div>
                <div class="partner-logos" style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px;">
                    <img src="https://via.placeholder.com/50" alt="Icon 1">
                    <img src="https://via.placeholder.com/50" alt="Icon 2">
                    <img src="https://via.placeholder.com/50" alt="Icon 3">
                </div>
            </div>
            <ul class="details-list" style="list-style-type: none; padding: 0; margin-bottom: 20px;">
                <li style="margin-bottom: 10px;">✔️ DATAUSER is a central-bank authorized Account Aggregator</li>
                <li style="margin-bottom: 10px;">✔️ DATAUSER cannot read or store any of your data</li>
                <li style="margin-bottom: 10px;">✔️ DATAUSER can help share your selected accounts</li>
            </ul>
            <div class="setup-time" style="background-color: #e2e8f0; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <div>
                    <img src="https://via.placeholder.com/20" alt="Clock Icon">
                    Setting up on Account Aggregator might take 10 minutes. But don’t worry, you won’t have to do it again.
                </div>
                <button style="margin-top: 10px; background: none; border: none; color: #0056b3; text-decoration: underline; cursor: pointer;" onclick="toggleSteps()">See the steps ahead ⬇️</button>
                <div id="steps-info">
                    <p>Step 1: Register with the Account Aggregator.</p>
                    <p>Step 2: Link your bank accounts.</p>
                    <p>Step 3: Provide consent to share data.</p>
                </div>
            </div>
            <button onclick="showPage('page5')">Continue</button>
        </div>

        <!-- Page 5: Select Accounts to Share -->
        <div id="page5" class="content-section hidden">
            <header>
                <div class="back-button" onclick="showPage('page4')">&#8592;</div>
                <h1>Share Accounts</h1>
            </header>
            <div class="progress-bar">
                <div class="progress" id="progressBar" style="width: 50%;"></div>
            </div>
            <h2>Select accounts to share</h2>
            <div class="tab-bar" style="display: flex; justify-content: center; margin-bottom: 20px;">
                <div class="tab active" style="margin-right: 20px; cursor: pointer; font-weight: bold; text-decoration: underline;">Bank Accounts</div>
                <div class="tab" style="cursor: pointer; color: #666;">Mutual Funds</div>
            </div>
            <div class="account-card" style="background-color: #0056b3; color: white; border-radius: 12px; padding: 15px; display: flex; align-items: center; margin-bottom: 20px;">
                <img src="https://img.icons8.com/ios-filled/50/ffffff/bank-building.png" alt="Bank Icon" style="background-color: #0056b3; border-radius: 50%; padding: 10px;">
                <div style="margin-left: 15px;">
                    <h3>Bank Accounts</h3>
                    <p>Accounts discovered based on your selection</p>
                </div>
            </div>
            <div class="info-section" style="background-color: #f9f9f9; padding: 15px; border-radius: 12px;">
                <h3>See what you will share</h3>
                <ul style="list-style-type: disc; margin-left: 20px; margin-top: 10px;">
                    <li>Credit transactions over $10,000</li>
                    <li>Current Balance</li>
                    <li>Transactions</li>
                    <li>Profile Information</li>
                </ul>
                <div class="date-range" style="margin-top: 20px;">
                    <p>For the period of:</p>
                    <input type="date" id="startDate" value="">
                    <span style="margin: 0 10px;">to</span>
                    <input type="date" id="endDate" value="">
                </div>
            </div>
            <button onclick="proceedFromPage5()">Next</button>
        </div>

        <!-- Page 6: Account Selection with Checkboxes -->
        <div id="page6" class="content-section hidden">
            <header>
                <div class="back-button" onclick="showPage('page5')">&#8592;</div>
                <h1>Share Accounts</h1>
            </header>
            <div class="progress-bar">
                <div class="progress" id="progressBar" style="width: 75%;"></div>
            </div>
            <div class="account-selection" style="margin-top: 20px;">
                <div class="account-header" style="display: flex; align-items: center; margin-bottom: 20px;">
                    <h2 style="display: flex; align-items: center;">
                        <img src="https://img.icons8.com/ios-filled/50/0056b3/bank-building.png" alt="Bank Icon" style="width:24px; margin-right: 10px;"> Bank Accounts
                    </h2>
                    <p style="margin-left: auto;">Accounts based on your banks</p>
                </div>
                <div class="accounts-list" id="accountsList">
                    <!-- Accounts will be dynamically generated here -->
                </div>
            </div>
            <button onclick="proceedFromPage6()">Submit</button>
        </div>

        <!-- Page 7: Authorization Success -->
        <div id="page7" class="content-section hidden">
            <header>
                <div></div>
                <h1>Share Accounts</h1>
            </header>
            <div class="progress-bar">
                <div class="progress" id="progressBar" style="width: 100%;"></div>
            </div>
            <div class="success-message fade-enter">
                <div class="success-icon">&#10004;</div>
                <p>Bank Accounts Successfully Authorized</p>
                <button onclick="submitData()">Finish</button>
            </div>
        </div>

    </div>
    <!-- JavaScript -->
    <script>
        let interactionLog = [];
        let currentState = {
            page: 'page1',
            banks: [],
            features: [],
            specification: '',
            termsExpanded: false,
            termsScrollPercentage: 0,
            agreedToTerms: false,
            startDate: '',
            endDate: ''
        };

        function logInteraction(action, details = {}) {
            const timestamp = new Date().toISOString();
            const logEntry = { timestamp, action, ...details, currentState: { ...currentState } };
            interactionLog.push(logEntry);
            console.log('Interaction logged:', logEntry);
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.content-section').forEach(page => {
                page.classList.add('hidden');
            });
            // Show the requested page
            document.getElementById(pageId).classList.remove('hidden');
            currentState.page = pageId;
            logInteraction('Page Navigation', { toPage: pageId });

            // Apply transition if going to page7
            if (pageId === 'page7') {
                const successMessage = document.querySelector('.success-message');
                successMessage.classList.add('fade-enter');
                setTimeout(() => {
                    successMessage.classList.add('fade-enter-active');
                }, 10);
            }
        }

        function updateState() {
            // Update state based on inputs
            currentState.username = document.getElementById('username') ? document.getElementById('username').value : '';
            currentState.password = document.getElementById('password') ? document.getElementById('password').value : '';
            currentState.banks = Array.from(document.querySelectorAll('.bank:checked')).map(bank => bank.value);
            currentState.features = Array.from(document.querySelectorAll('.features:checked')).map(feature => feature.value);
            currentState.startDate = document.getElementById('startDate') ? document.getElementById('startDate').value : '';
            currentState.endDate = document.getElementById('endDate') ? document.getElementById('endDate').value : '';
        }

        function toggleAccountOption(element, accountType) {
            element.classList.toggle('active');
            if (currentState.selectedAccounts && currentState.selectedAccounts.includes(accountType)) {
                currentState.selectedAccounts = currentState.selectedAccounts.filter(acc => acc !== accountType);
            } else {
                currentState.selectedAccounts = currentState.selectedAccounts || [];
                currentState.selectedAccounts.push(accountType);
            }
            logInteraction('Account Option Toggled', { accountType: accountType });
        }

        function toggleCheckbox(item) {
            const checkbox = item.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            item.classList.toggle('active', checkbox.checked);
            updateState();
            logInteraction('Bank Checkbox Change', { id: checkbox.value, checked: checkbox.checked });
        }

        function toggleFeatureCheckbox(item) {
            const checkbox = item.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            item.classList.toggle('active', checkbox.checked);
            updateState();
            logInteraction('Feature Checkbox Change', { id: checkbox.value, checked: checkbox.checked });
        }

        function submitData() {
            updateState();
            logInteraction('Data Submission');
            sendFinalLog();
            alert('Thank you for your submission! The interaction log has been downloaded.');
            resetForms();
        }

        function resetForms() {
            // Reset all forms and states
            document.querySelectorAll('input').forEach(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            currentState = {
                page: 'page1',
                banks: [],
                features: [],
                specification: '',
                termsExpanded: false,
                termsScrollPercentage: 0,
                agreedToTerms: false,
                startDate: '',
                endDate: ''
            };
            showPage('page1');
            logInteraction('Forms Reset');
        }

        function toggleInfo() {
            const extraInfo = document.getElementById('extra-info');
            extraInfo.style.display = extraInfo.style.display === 'none' || extraInfo.style.display === '' ? 'block' : 'none';
            logInteraction('Toggle Info', { expanded: extraInfo.style.display === 'block' });
        }

        // Live search functionality for page3
        document.getElementById('search-input').addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const bankItems = document.querySelectorAll('#bankList li');
            bankItems.forEach(item => {
                const bankLabel = item.querySelector('label').textContent.toLowerCase();
                if (bankLabel.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
            logInteraction('Bank Search', { query: query });
        });

        function toggleSteps() {
            const stepsInfo = document.getElementById('steps-info');
            stepsInfo.style.display = stepsInfo.style.display === 'none' || stepsInfo.style.display === '' ? 'block' : 'none';
            logInteraction('Toggle Steps Info', { expanded: stepsInfo.style.display === 'block' });
        }

        function proceedFromPage2() {
            if (!currentState.selectedAccounts || currentState.selectedAccounts.length === 0) {
                alert('Please select at least one account type.');
                return;
            }
            showPage('page3');
        }

        function proceedFromPage3() {
            if (!currentState.banks || currentState.banks.length === 0) {
                alert('Please select at least one bank.');
                return;
            }
            showPage('page4');
        }

        function proceedFromPage5() {
            updateState();
            if (!currentState.startDate || !currentState.endDate) {
                alert('Please select both start and end dates.');
                return;
            }
            generateAccounts();
            showPage('page6');
        }

        function proceedFromPage6() {
            if (!currentState.features || currentState.features.length === 0) {
                alert('Please select at least one account to share.');
                return;
            }
            showPage('page7');
        }

        function generateAccounts() {
            const accountsList = document.getElementById('accountsList');
            accountsList.innerHTML = '';
            currentState.accountDetails = [];
            currentState.banks.forEach(bank => {
                ['Checking', 'Savings'].forEach(accountType => {
                    const accountNumber = Math.floor(1000 + Math.random() * 9000);
                    const accountId = `${bank} ${accountType} (${accountNumber})`;
                    const accountItem = document.createElement('label');
                    accountItem.classList.add('account-item');
                    accountItem.onclick = function() {
                        toggleFeatureCheckbox(this);
                    };

                    accountItem.innerHTML = `
                        <span class="bank-name">${bank}</span>
                        <div class="account-details" style="display: flex; align-items: center; margin-left: auto;">
                            <span>${accountType} Account (${accountNumber})</span>
                            <input type="checkbox" class="features" value="${accountId}">
                        </div>
                    `;
                    accountsList.appendChild(accountItem);
                    currentState.accountDetails.push(accountId);
                });
            });
        }

        // Log page load
        window.addEventListener('load', () => {
            logInteraction('Page Load');
            resetForms();
        });

        function sendFinalLog() {
            const finalLog = {
                interactionLog: interactionLog,
                finalState: currentState
            };

            // Create a Blob with the JSON data
            const blob = new Blob([JSON.stringify(finalLog, null, 2)], { type: 'application/json' });

            // Create a link element and trigger the download
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'interaction_log.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            console.log('Final log downloaded:', finalLog);
        }

        // Log page unload and download final log
        window.addEventListener('beforeunload', (event) => {
            logInteraction('Page Unload');
            sendFinalLog();
            // Uncomment the following line if you want to show a confirmation dialog when leaving the page
            // event.returnValue = '';
        });

    </script>
</body>
</html>
