<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy Implementation Notice - Silence Laboratories</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Combined Custom CSS -->
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Typography improvements */
        .prose {
            max-width: 65ch;
            line-height: 1.6;
        }

        .prose p {
            margin-bottom: 1.5em;
            color: #374151;
        }

        .prose ul {
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }

        .prose li {
            margin-bottom: 0.5em;
            color: #374151;
        }

        /* Highlight styles */
        .highlight-primary {
            background: linear-gradient(120deg, rgba(96, 165, 250, 0.2) 0%, rgba(96, 165, 250, 0.2) 100%);
            padding: 0.2em 0.1em;
            border-radius: 0.2em;
        }

        .highlight-security {
            background: linear-gradient(120deg, rgba(52, 211, 153, 0.2) 0%, rgba(52, 211, 153, 0.2) 100%);
            padding: 0.2em 0.1em;
            border-radius: 0.2em;
        }

        .highlight-tech {
            background: linear-gradient(120deg, rgba(167, 139, 250, 0.2) 0%, rgba(167, 139, 250, 0.2) 100%);
            padding: 0.2em 0.1em;
            border-radius: 0.2em;
        }

        .highlight-control {
            background: linear-gradient(120deg, rgba(251, 146, 60, 0.2) 0%, rgba(251, 146, 60, 0.2) 100%);
            padding: 0.2em 0.1em;
            border-radius: 0.2em;
        }

        /* Smooth transitions */
        .hover-transform {
            transition: transform 0.2s ease-in-out;
        }

        .hover-transform:hover {
            transform: translateY(-2px);
        }

        /* Custom list styling */
        .custom-list {
            list-style-type: none;
            padding-left: 1.5em;
        }

        .custom-list li::before {
            content: "â€¢ ";
            color: #2563EB;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        /* Legend styling */
        .highlight-legend {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Reset and base styles for second page */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        /* Container styles for the second page */
        .data-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .data-container h1 {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: #2c3e50;
        }

        .category-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .category-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .checkbox-container {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        input[type="checkbox"] {
            margin-top: 0.3rem;
            margin-right: 1rem;
            width: 18px;
            height: 18px;
        }

        .data-point {
            margin-left: 2.5rem;
            margin-bottom: 1.5rem;
        }

        .data-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .data-description {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .button-container {
            margin-top: 2rem;
            text-align: right;
        }

        .next-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .next-button:hover {
            background: #357abd;
        }

        /* Third Page Styles */
        .third-page {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
            font-size: 2rem;
            color: #2c3e50;
        }

        /* Hidden class */
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Page 1: Privacy Implementation Notice with Highlights -->
    <div id="page1" class="block">
        <!-- Main Content -->
        <main class="container mx-auto max-w-3xl px-4 py-8">
            <div class="bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">
                    Privacy Implementation Notice
                </h1>

                <!-- Legend -->
                <div class="highlight-legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: rgba(96, 165, 250, 0.2)"></div>
                        <span>Key Concepts</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: rgba(52, 211, 153, 0.2)"></div>
                        <span>Security Features</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: rgba(167, 139, 250, 0.2)"></div>
                        <span>Technical Terms</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: rgba(251, 146, 60, 0.2)"></div>
                        <span>User Control</span>
                    </div>
                </div>

                <div class="prose">
                    <p>
                        Silence Laboratories provides a <span class="highlight-security">privacy solution</span> that enhances the <span class="highlight-security">security of your banking data</span> and improves how your <span class="highlight-primary">financial information is protected and shared</span>. Our system creates a <span class="highlight-primary">protected environment</span> where your <span class="highlight-control">privacy choices</span> are enforced through <span class="highlight-tech">advanced security measures</span>.
                    </p>
                    <p>
                        When you link your bank accounts through our platform, we create a <span class="highlight-security">secure system</span> that automatically enforces your <span class="highlight-control">privacy choices</span>. Unlike traditional systems that rely on simple permission settings we ensure that anyone trying to access your data has to follow your <span class="highlight-primary">exact privacy preferences</span> - it's not just a policy, it's <span class="highlight-primary">built into the system</span> itself.
                    </p>
                    <p>
                        Our technology enables other services to analyze your data while keeping it <span class="highlight-security">encrypted and distributed across systems</span>, ensuring <span class="highlight-primary">no one can see your actual account details</span>. We enforce that only your <span class="highlight-control">approved calculations</span> can be performed, creating <span class="highlight-security">strong privacy protections</span> where services receive only the <span class="highlight-primary">specific insights you've authorized</span>, with <span class="highlight-security">guarantees against unauthorized access or analysis</span>.
                    </p>
                    <!-- How We Protect You Section -->
                    <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-4">
                        How We Protect You
                    </h2>
                    <div class="bg-blue-50 p-6 rounded-lg mb-8">
                        <ul class="custom-list space-y-2">
                            <li>You're always in <span class="highlight-control">control</span> of what information others can see</li>
                            <li>Companies only get the <span class="highlight-primary">specific insights you allow</span>, never your actual banking data</li>
                            <li>Our <span class="highlight-security">technology automatically enforces</span> these privacy rules, making it impossible to bypass them</li>
                        </ul>
                    </div>
                    <!-- Your Rights Section -->
                    <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-4">
                        Your Rights
                    </h2>
                    <div class="bg-blue-50 p-6 rounded-lg mb-8">
                        <ul class="custom-list space-y-2">
                            <li><span class="highlight-control">Select</span> which parts of your financial data can be analyzed</li>
                            <li><span class="highlight-control">Choose exactly</span> what others can learn from your data</li>
                            <li><span class="highlight-control">Stop sharing access</span> whenever you want</li>
                            <li>Get clear information about how your data is being used</li>
                        </ul>
                    </div>
                    <p class="text-gray-700 mt-8">
                        By continuing, you'll activate our <span class="highlight-security">secure system</span> that <span class="highlight-primary">guarantees</span> your data privacy choices will be followed exactly as you set them.
                    </p>
                </div>

                <!-- Proceed Button -->
                <div class="mt-8 flex justify-center">
                    <button id="proceed-button" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-8 py-3 rounded-lg hover-transform focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Proceed
                    </button>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-100 mt-12">
            <div class="container mx-auto px-4 py-6 text-center text-gray-600">
                <p>&copy; 2024 Silence Laboratories. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Page 2: Data Sharing Preferences -->
    <div id="page2" class="hidden">
        <div class="data-container" id="data-container">
            <h1>Data Sharing Preferences</h1>
            <!-- Content will be dynamically inserted here -->
            <div id="dynamic-content"></div>
            <!-- Next Button -->
            <div class="button-container">
                <button id="next-button" class="next-button">Next</button>
            </div>
        </div>
    </div>

    <!-- Page 3: Return to Survey -->
    <div id="page3" class="hidden third-page">
        RETURN TO THE SURVEY
    </div>

    <!-- Interaction Logging Scripts -->
    <script>
        // Initialize interaction log
        let interactionLog = [];
        let currentState = {
            page: 'page1',
            banks: [],
            features: [],
            specification: '',
            termsExpanded: false,
            termsScrollPercentage: 0,
            agreedToTerms: false
        };

        // Function to log interactions
        function logInteraction(action, details = {}) {
            const timestamp = new Date().toISOString();
            const logEntry = { timestamp, action, ...details, currentState: { ...currentState } };
            interactionLog.push(logEntry);
            console.log('Interaction logged:', logEntry);
        }

        // Function to update current state
        function updateState() {
            currentState.banks = Array.from(document.querySelectorAll('.bank:checked')).map(bank => bank.value);
            currentState.features = Array.from(document.querySelectorAll('.feature-checkbox:checked')).map(feature => feature.id);
            const specificationInput = document.getElementById('specification');
            currentState.specification = specificationInput ? specificationInput.value : currentState.specification;
            const agreeTermsCheckbox = document.getElementById('agreeTerms');
            currentState.agreedToTerms = agreeTermsCheckbox ? agreeTermsCheckbox.checked : currentState.agreedToTerms;
        }

        // Function to generate Data Sharing Preferences content
        const pageContent = {
            categories: [
                {
                    id: "personal_info",
                    title: "Personally Identifiable Information",
                    description: "This section covers your essential banking identifiers - the basic information needed to identify you and your accounts securely. We need these details to comply with banking regulations and ensure secure transactions. We use advanced privacy technology to verify this information without actually storing or seeing the details themselves, keeping your personal data protected.",
                    dataPoints: [
                        {
                            id: "pan",
                            title: "Permanent Account Number of the user",
                            description: "Your PAN (Permanent Account Number) is a government-issued ID number for tax purposes."
                        },
                        {
                            id: "account_number",
                            title: "Bank account number of the user",
                            description: "This is your unique bank account identifier."
                        },
                        {
                            id: "account_type",
                            title: "Bank account type of the user",
                            description: "Whether your account is savings, current, or fixed deposit."
                        }
                    ]
                },
                {
                    id: "balances",
                    title: "Account Balances",
                    description: "This section is about how much money you have in your accounts at different times. We use privacy technology to check your balances securely when needed, without keeping ongoing records of your money. This helps us ensure transactions are possible while protecting your financial privacy.",
                    dataPoints: [
                        {
                            id: "current_balance",
                            title: "Amount value of the account as of the latest date",
                            description: "Your present account balance."
                        },
                        {
                            id: "month_end_balance",
                            title: "Balances as on the end of the month",
                            description: "Your balance at the end of each month."
                        },
                        {
                            id: "daily_balance",
                            title: "End of day balances for every day of the month",
                            description: "Your end-of-day account balances."
                        }
                    ]
                },
                {
                    id: "transaction",
                    title: "Transaction Summary",
                    description: "This section shows the overall picture of money moving in and out of your accounts. We look at these patterns to keep your account safe and follow banking rules, while using privacy technology to avoid seeing the details of individual transactions.",
                    dataPoints: [
                        {
                            id: "total_amount_credit",
                            title: "Total amount credited to the user's account",
                            description: "Total money coming into your account."
                        },
                        {
                            id: "total_amount_debited",
                            title: "Total amount debited from the user's account",
                            description: "Total money going out of your account."
                        },
                        {
                            id: "six_month",
                            title: "The 6 month average salary of the user",
                            description: "Your typical monthly income based on the last six months."
                        },
                        {
                            id: "monthly_cash_deposited",
                            title: "The monthly cash deposit to total credit amount ratio",
                            description: "How much of your incoming money is cash deposits."
                        },
                        {
                            id: "total_number_cheque_bounces",
                            title: "Total number of outward cheque bounces",
                            description: "How many checks couldn't be processed due to insufficient funds."
                        }
                    ]
                },
                {
                    id: "expense_analysis",
                    title: "Expense Analysis",
                    description: "This section organizes your spending into categories to help you understand your money habits. We use privacy technology to group your expenses without seeing the specific purchases, helping you track your budget while protecting your privacy.",
                    dataPoints: [
                        {
                            id: "classification_users_monthly_expenses",
                            title: "Betting and Cash Withdrawal Flags",
                            description: "Groups your spending into categories like groceries and utilities."
                        }
                    ]
                },
                {
                    id: "financial_ratios",
                    title: "Financial Ratios",
                    description: "These are measurements that help understand your overall financial wellbeing. We calculate these numbers using privacy technology that protects your personal information while helping assess eligibility for financial services.",
                    dataPoints: [
                        {
                            id: "foir",
                            title: "Financial Obligation Ratio (FOIR)",
                            description: "Shows how much of your income goes to regular payments."
                        },
                        {
                            id: "betting_withdrawl_flags",
                            title: "Betting and Cash Withdrawal Flags",
                            description: "Helps identify potentially concerning transaction patterns."
                        }
                    ]
                }
            ]
        };
        
        function generateOptionsPage(content) {
            const container = document.getElementById('dynamic-content');
            
            content.categories.forEach(category => {
                const categorySection = document.createElement('div');
                categorySection.className = 'category-section';
                categorySection.innerHTML = `
                    <div class="category-header">
                        <div class="checkbox-container">
                            <input type="checkbox" id="${category.id}" class="category-checkbox">
                            <label for="${category.id}">
                                <div class="data-title">${category.title}</div>
                                <div class="data-description">${category.description}</div>
                            </label>
                        </div>
                    </div>
                    ${category.dataPoints.map(point => `
                        <div class="data-point">
                            <div class="checkbox-container">
                                <input type="checkbox" id="${point.id}" class="feature-checkbox">
                                <div>
                                    <label for="${point.id}" class="data-title">${point.title}</label>
                                    <div class="data-description">${point.description}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;
                container.appendChild(categorySection);
            });

            // Set up checkbox behavior
            setupCheckboxes();
        }

        // Function to handle checkbox behavior
        function setupCheckboxes() {
            const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
            categoryCheckboxes.forEach(checkbox => {
                const section = checkbox.closest('.category-section');
                const subCheckboxes = section.querySelectorAll('.feature-checkbox');
                
                checkbox.addEventListener('change', () => {
                    subCheckboxes.forEach(subCheckbox => {
                        subCheckbox.checked = checkbox.checked;
                        logInteraction('Checkbox Change', { 
                            id: subCheckbox.id, 
                            checked: subCheckbox.checked, 
                            type: 'feature-checkbox',
                            category: checkbox.id
                        });
                    });
                    logInteraction('Category Checkbox Change', { 
                        id: checkbox.id, 
                        checked: checkbox.checked, 
                        type: 'category-checkbox' 
                    });
                });

                subCheckboxes.forEach(subCheckbox => {
                    subCheckbox.addEventListener('change', () => {
                        const allChecked = Array.from(subCheckboxes).every(cb => cb.checked);
                        const anyChecked = Array.from(subCheckboxes).some(cb => cb.checked);
                        checkbox.checked = allChecked;
                        checkbox.indeterminate = anyChecked && !allChecked;
                        logInteraction('Checkbox Change', { 
                            id: subCheckbox.id, 
                            checked: subCheckbox.checked, 
                            type: 'feature-checkbox',
                            category: checkbox.id
                        });
                    });
                });
            });
        }

        // Function to trigger log download
        // function downloadLog() {
        //     const finalLog = {
        //         interactionLog: interactionLog,
        //         finalState: currentState
        //     };
            
        //     // Create a Blob with the JSON data
        //     const blob = new Blob([JSON.stringify(finalLog, null, 2)], {type: 'application/json'});
            
        //     // Create a link element and trigger the download
        //     const a = document.createElement('a');
        //     a.href = URL.createObjectURL(blob);
        //     a.download = 'interaction_log.json';
        //     document.body.appendChild(a);
        //     a.click();
        //     document.body.removeChild(a);

        //     console.log('Final log downloaded:', finalLog);
        // }
        const URLParamsHandler = {
            // Get all URL parameters as an object
            getAllParams() {
                const params = {};
                const queryString = window.location.search;
                const urlParams = new URLSearchParams(queryString);
                
                for (const [key, value] of urlParams.entries()) {
                params[key] = value;
                }
                
                return params;
            },

            // Get a specific parameter by name
            getParam(paramName) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(paramName);
            },

            // Check if a parameter exists
            hasParam(paramName) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.has(paramName);
            },

            // Get parameters and apply them to elements with matching data-param attributes
            applyParamsToElements() {
                const params = this.getAllParams();
                
                for (const [key, value] of Object.entries(params)) {
                const elements = document.querySelectorAll(`[data-param="${key}"]`);
                elements.forEach(element => {
                    // Handle different element types
                    if (element.tagName === 'INPUT') {
                    element.value = value;
                    } else {
                    element.textContent = value;
                    }
                });
                }
            }
        };
        
        function downloadLog() {
            const allParams = URLParamsHandler.getAllParams();
            console.log('All parameters:', allParams);
            const name = URLParamsHandler.getParam('prolificid');
            if (name) {
                console.log('prolificid parameter:', name);
            }
            const stringifiedData = JSON.stringify({
                data: {
                    interactionLog: interactionLog,
                    finalState: currentState,
                    prolificid: name,
                    version: 'intro_highlight_non_technical_option_high_level_with_all_contents.html',
                }
            });
            const finalLog = JSON.parse(stringifiedData);
            
            fetch('https://survey.suriya.cc/append/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: stringifiedData
            })
            .then(response => {
                if (!response.ok) {
                    console.error('Failed to send log data');
                }
            })
            .catch(error => {
                console.error('Error sending log data:', error);
            });
        }

        // Handle navigation between pages and logging
        document.getElementById('proceed-button').addEventListener('click', () => {
            logInteraction('Proceed Button Clicked');
            document.getElementById('page1').classList.add('hidden');
            document.getElementById('page2').classList.remove('hidden');
            currentState.page = 'page2';
        });

        document.getElementById('next-button').addEventListener('click', () => {
            logInteraction('Next Button Clicked');
            document.getElementById('page2').classList.add('hidden');
            document.getElementById('page3').classList.remove('hidden');
            currentState.page = 'page3';
            downloadLog();
        });

        // Initialize the Data Sharing Preferences page
        document.addEventListener('DOMContentLoaded', () => {
            generateOptionsPage(pageContent);
            logInteraction('Page Load', { page: 'page1' });
        });

        // Event listeners for checkbox changes in page2
        document.addEventListener('change', (event) => {
            if (event.target.matches('.category-checkbox')) {
                // Handled in setupCheckboxes
            } else if (event.target.matches('.feature-checkbox')) {
                // Handled in setupCheckboxes
            }
        });

        // Log page unload
        window.addEventListener('beforeunload', () => {
            logInteraction('Page Unload', { page: currentState.page });
            // Optionally, you can trigger log download here as a fallback
            // downloadLog();
        });
    </script>
</body>
</html>
